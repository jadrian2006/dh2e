<div class="dh2e chat-card check-card">
    <header class="card-header {{#if success}}success{{else}}failure{{/if}}">
        <h3>{{title}}{{#if untrained}} <span class="untrained-badge">{{localize "DH2E.Skill.Untrained"}}</span>{{/if}}</h3>
        <span class="result-badge">
            {{#if success}}
                {{localize "DH2E.Check.Success"}} — {{format "DH2E.Check.DegreesOfSuccess" count=degrees}}
            {{else}}
                {{localize "DH2E.Check.Failure"}} — {{format "DH2E.Check.DegreesOfFailure" count=degrees}}
            {{/if}}
        </span>
    </header>
    <div class="card-body">
        <p class="roll-summary">{{format "DH2E.Check.Roll" roll=roll target=target}}</p>

        {{!-- DoS threshold result --}}
        {{#if dosThreshold}}
        <p class="dos-threshold {{#if thresholdMet}}met{{else}}not-met{{/if}}">
            {{#if thresholdMet}}
                {{format "DH2E.DoS.ThresholdMet" dos=degrees threshold=dosThreshold}}
            {{else}}
                {{format "DH2E.DoS.ThresholdNotMet" dos=degrees threshold=dosThreshold}}
            {{/if}}
        </p>
        {{/if}}

        {{!-- Degrees breakdown --}}
        <details class="dos-breakdown">
            <summary>{{localize "DH2E.DoS.Breakdown"}}</summary>
            <div class="dos-math">
                <span>{{format "DH2E.DoS.TargetTens" value=targetTens}}</span>
                <span class="separator">|</span>
                <span>{{format "DH2E.DoS.RollTens" value=rollTens}}</span>
            </div>
            <p class="dos-formula">
                {{#if success}}
                1 + ({{targetTens}} − {{rollTens}}) = {{degrees}} DoS
                {{else}}
                1 + ({{rollTens}} − {{targetTens}}) = {{degrees}} DoF
                {{/if}}
            </p>
        </details>

        {{#if modifiers.length}}
        <details class="modifier-breakdown">
            <summary>Modifiers</summary>
            <ul>
                {{#each modifiers}}
                <li>
                    <span class="mod-label">{{this.label}}</span>
                    <span class="mod-value">{{signedInteger this.value}}</span>
                </li>
                {{/each}}
            </ul>
        </details>
        {{/if}}

        <div class="card-actions">
            <button class="fate-btn" data-action="spend-fate" title="{{localize "DH2E.Fate.InvokeFate"}}">
                <i class="fas fa-star"></i>
            </button>
            {{#if isGM}}
            <button class="gm-override-btn" data-action="gm-override" title="GM Override"><i class="fas fa-cog"></i></button>
            {{/if}}
        </div>
    </div>
</div>
